!function(t){var e=function(e,i){this.trigger=t(e),this.defaults={transitionDelay:300,relativeNavigation:!0,showCaption:!0,showPositionCaption:!0,beforeClose:t.noop,afterClose:t.noop,beforeLoad:t.noop,afterLoad:t.noop,labels:{error:"Image could not be loaded",closeText:"Fermer le lightbox",arrowPrevText:"Afficher l'élément précédent",arrowNextText:"Afficher l'élément suivant"},classes:{wrapper:"lightbox-wrapper",overlay:"lightbox-overlay",container:"lightbox-container",content:"lightbox-content",sliderWrapper:"lightbox-slider-wrapper",sliderContainer:"lightbox-slider-container",sliderElement:"lightbox-slider-element",navigation:"lightbox-navigation",close:"lightbox-navigation-close",arrowPrev:"lightbox-navigation-prev",arrowNext:"lightbox-navigation-next",caption:"lightbox-caption",captionWrapper:"lightbox-caption-wrapper",captionContent:"lightbox-caption-content",captionPosition:"lightbox-caption-position",iframeContainer:"iframe-container",backgroundContainer:"lightbox-bg-container",guard:"lightbox-guard",error:"lightbox-error",beforeLoad:"is-loading",afterLoad:"is-loaded",states:{active:"is-active"}}},this.classes=t.extend(!0,this.defaults.classes,window.project?window.project.classes:{}),this.labels=t.extend(!0,this.defaults.labels,window.project?window.project.labels:{}),this.config=t.extend(!0,this.defaults,i||{}),this.currentIndex=0,this.isLightboxAnimated=!1,this.publicMethods={},this.bindEvents()};t.extend(e.prototype,{bindEvents:function(){this.trigger.on("click",t.proxy(function(e){e.preventDefault(),this.referer=t(e.currentTarget),this.close(),this.createLightbox()},this))},bindCloseEvent:function(){this.lightboxNavigation.find("."+this.config.classes.close).add("."+this.config.classes.overlay).on("click",t.proxy(function(){this.config.beforeClose(),this.close(),this.config.afterClose()},this)),this.lightbox.add(this.lightbox.find("a, button, :input, [tabindex]")).on("blur",t.proxy(function(t){},this))},onBlur:function(e){window.setTimeout(t.proxy(function(){var e=document.activeElement;0===t(e).parents("."+this.config.classes.wrapper).length&&this.close()},this),1)},bindResizeEvent:function(){t(window).resize(function(){this.resizeTo&&clearTimeout(this.resizeTo),this.resizeTo=setTimeout(function(){t(this).trigger("resizeEnd")},100)}),t(window).bind("resizeEnd",t.proxy(function(){this.onResize()},this))},onResize:function(){this.resizeLayout(),this.updateCaptionLayout(this.lightbox.find("img, iframe"))},bindGalleryNavigation:function(){this.bindPrevEvent(),this.bindNextEvent(),this.bindKeyboardEvent(),this.bindSwipeEvent()},bindPrevEvent:function(){this.lightboxPrev.on("click",t.proxy(function(){this.isLightboxAnimated||this.changePrevElement()},this))},bindNextEvent:function(){this.lightboxNext.on("click",t.proxy(function(){this.isLightboxAnimated||this.changeNextElement()},this))},bindKeyboardEvent:function(){this.lightbox.on("keydown",t.proxy(function(t){this.onKeyboardEvent(t)},this))},onKeyboardEvent:function(t){37!==t.which||this.isLightboxAnimated?39!==t.which||this.isLightboxAnimated?27===t.which&&this.close():this.changeNextElement():this.changePrevElement()},bindSwipeEvent:function(){this.detectswipe(this.lightbox,t.proxy(function(t){"left"!==t||this.isLightboxAnimated?"right"!==t||this.isLightboxAnimated||this.changePrevElement():this.changeNextElement()},this))},createLightbox:function(){var e=t('<div class="'+this.config.classes.wrapper+" type-"+this.trigger.data("type")+'"></div>');t("body").append(e).append('<button class="'+this.classes.guard+' visuallyhidden"></button>'),this.lightbox=t("."+this.config.classes.wrapper),this.isGallery()?(this.lightbox.addClass("is-gallery"),this.createGalleryContainer()):(this.lightbox.addClass("is-single"),this.createSingleContainer()),this.createNavigation(),this.createOverlay(),this.bindCloseEvent(),this.bindResizeEvent(),this.setCurrentIndex(),this.loadContent(),this.resizeLayout(),this.isGallery()&&(this.loadPrevElement(),this.loadNextElement(),this.updateSliderLayout()),this.focusLightbox()},createOverlay:function(){this.lightbox.append('<div class="'+this.config.classes.overlay+'"></div>'),this.lightboxOverlay=t("."+this.config.classes.overlay)},createGalleryContainer:function(){this.lightbox.prepend('<div class="'+this.config.classes.sliderWrapper+'"></div>'),this.lightboxSliderWrapper=t("."+this.config.classes.sliderWrapper),this.lightboxSliderWrapper.prepend('<div class="'+this.config.classes.sliderContainer+'"></div>'),this.lightboxContainer=t("."+this.config.classes.sliderContainer)},createSingleContainer:function(){this.lightbox.prepend('<div class="'+this.config.classes.container+'"></div>'),this.lightboxContainer=t("."+this.config.classes.container)},createNavigation:function(){var e='<button class="'+this.config.classes.close+'"><span class="visuallyhidden">'+this.config.closeText+"</span></button>";this.config.relativeNavigation&&!this.isGallery()?this.lightboxContainer.append('<div class="'+this.config.classes.navigation+' is-relative">'+e+"</div>"):this.lightbox.append('<div class="'+this.config.classes.navigation+'">'+e+"</div>"),this.lightboxNavigation=t("."+this.config.classes.navigation),this.isGallery()&&this.createGalleryNavigation()},createGalleryNavigation:function(){var t='<button class="'+this.config.classes.arrowPrev+'"><span class="visuallyhidden">'+this.config.arrowPrevText+"</span></button>",e='<button class="'+this.config.classes.arrowNext+'"><span class="visuallyhidden">'+this.config.arrowNextText+"</span></button>";this.lightboxNavigation.prepend(t+e),this.lightboxPrev=this.lightboxNavigation.find("."+this.config.classes.arrowPrev),this.lightboxNext=this.lightboxNavigation.find("."+this.config.classes.arrowNext),this.bindGalleryNavigation()},loadContent:function(e,i){var s=void 0!==e?e:this.trigger,n=void 0!==i?i:"append",a=s.data("type"),o=t('<div class="'+this.config.classes.content+'"></div>');switch(a){case"youtube":o.append(this.loadYoutubeMarkup(s));break;case"vimeo":o.append(this.loadVimeoMarkup(s));break;case"ajax":o.append(this.loadAjaxMarkup(s));break;case"map":o.append(this.loadMapMarkup(s));break;case"html":o.append(this.loadHTMLMarkup(s));break;default:o.append(this.loadImageMarkup(s))}o=this.addCaptions(o,s),$currentElement=t('<div class="'+this.config.classes.sliderElement+'" tabindex="-1">'+o[0].outerHTML+"</div>"),this.isGallery()&&$currentElement.css({width:100/3+"%","float":"left"}),"append"===n?this.lightboxContainer.append($currentElement):this.lightboxContainer.prepend($currentElement),this.lightboxContent=this.lightboxContainer.find("."+this.config.classes.content),this.loadEvent($currentElement)},loadYoutubeMarkup:function(t){var e=this.getYoutubeID(t.attr("href")),i='<div class="'+this.classes.iframeContainer+'"><iframe src="//www.youtube.com/embed/'+e+'?wmode=transparent" frameborder="0" width="1920" height="1080" tabindex="-1" allowfullscreen></iframe></div>';return i},loadVimeoMarkup:function(t){var e=this.getVimeoID(t.attr("href")),i='<div class="'+this.classes.iframeContainer+'"><iframe src="//player.vimeo.com/video/'+e+'" width="1920" height="1080" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>';return i},loadImageMarkup:function(t){var e=t.attr("href"),i=t.data("alt"),s='<img src="'+e+'" alt="'+i+'" />';return s},loadAjaxMarkup:function(t){var e='<div class="'+this.classes.iframeContainer+'"><iframe src="'+t.attr("href")+'" width="1920" height="1080" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>';return e},loadMapMarkup:function(t){var e='<div class="'+this.classes.iframeContainer+'"><iframe src="'+t.attr("href")+'" width="1920" height="1080" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen tabindex="-1"></iframe></div>';return e},loadHTMLMarkup:function(e){var i=t('.lightbox-html-content[data-lightbox-content="'+e.data("lightbox-content")+'"]'),s='<div class="'+this.classes.backgroundContainer+'">'+i.html()+"</div>";return s},addCaptions:function(e,i){var s=t("."+this.classes.captionContent+'[data-lightbox-caption="'+i.data("lightbox-caption")+'"]').html(),n=void 0!==s?s:"",a='<p class="'+this.classes.captionPosition+'">'+(this.getCurrentIndex(i)+1)+" sur "+this.getGalleryElements().length+"</p>",o='<div class="'+this.classes.caption+'">'+n+"</div>"+(this.config.showPositionCaption&&this.isGallery()?a:"");return this.config.showCaption&&e.append('<div class="'+this.classes.captionWrapper+'">'+o+"</div>"),e},loadEvent:function(e){var i=e.find("img, iframe");i.each(t.proxy(function(i,s){var n=t(s);this.beforeLoad(n),n.one("load",t.proxy(function(e){this.afterLoad(t(e.currentTarget))},this)).each(function(){this.complete&&t(this).load()}),n.on("error",t.proxy(function(i){this.afterLoad(t(i.currentTarget)),e.find("."+this.config.classes.content).html('<p class="'+this.classes.error+'">'+this.labels.error+"</p>")},this))},this))},beforeLoad:function(t){this.config.beforeLoad(),t.parents("."+this.classes.content).addClass(this.config.classes.beforeLoad)},afterLoad:function(t){this.config.afterLoad(),this.updateCaptionLayout(t),t.parents("."+this.classes.content).removeClass(this.config.classes.beforeLoad).addClass(this.config.classes.afterLoad)},updateCaptionLayout:function(e){e.each(t.proxy(function(e,i){for(var s=t(i),n=parseInt(this.lightbox.css("padding-top"))+parseInt(this.lightbox.css("padding-bottom")),a=t(window).height()-n,o=s.parents("."+this.config.classes.sliderElement).find("."+this.classes.captionWrapper),r=0;10>r;r++){var l=o.outerHeight(!0),h=s.outerHeight(!0);console.log(s.parents("."+this.config.classes.sliderElement).attr("style")),h+l>a&&!s.is("iframe")&&s.css("height",h-l),s.is("iframe")&&s.parents("."+this.classes.iframeContainer).css("width",16*(a-l)/9),o.css("max-width",s.width())}},this))},resizeLayout:function(){var e=this.slides||this.lightbox.find("."+this.config.classes.sliderElement),i=parseInt(this.lightbox.css("padding-top"))+parseInt(this.lightbox.css("padding-bottom")),s=t(window).height()-i;e.each(t.proxy(function(e,i){var n=t(i),a=n.find("."+this.classes.captionWrapper).outerHeight(!0);n.find("img").css("max-height",s),n.css("max-height",s),n.find("iframe").removeClass("resized"),n.find("."+this.classes.iframeContainer).css("width",16*(s-a)/9)},this))},updateSliderLayout:function(){this.slides=this.lightbox.find("."+this.config.classes.sliderElement),this.lightboxContainer.css({width:100*this.slides.length+"%",left:"-100%"}),this.slides.css({width:100/this.slides.length+"%","float":"left"})},loadPrevElement:function(){var t=this.currentIndex-1,e=this.getGalleryElements();0>t&&(t=e.length-1),this.loadContent(e.eq(t),"prepend")},loadNextElement:function(){var t=this.currentIndex+1,e=this.getGalleryElements();t>e.length-1&&(t=0),this.loadContent(e.eq(t),"append")},removeFirstElement:function(){this.slides.first().remove()},removeLastElement:function(){this.slides.last().remove()},changePrevElement:function(){this.isLightboxAnimated=!0,this.lightboxContainer.css({left:"0%",transition:"left "+this.config.transitionDelay+"ms"}),window.setTimeout(t.proxy(function(){this.lightboxContainer.css("transition","none"),this.afterChangePrevElement()},this),this.config.transitionDelay)},afterChangePrevElement:function(){this.decrementCurrentIndex(),this.removeLastElement(),this.loadPrevElement(),this.resizeLayout(),this.updateSliderLayout(),window.setTimeout(t.proxy(function(){this.isLightboxAnimated=!1},this),100)},changeNextElement:function(){this.isLightboxAnimated=!0,this.lightboxContainer.css({left:"-200%",transition:"left "+this.config.transitionDelay+"ms"}),window.setTimeout(t.proxy(function(){this.lightboxContainer.css("transition","none"),this.afterChangeNextElement()},this),this.config.transitionDelay)},afterChangeNextElement:function(){this.incrementCurrentIndex(),this.removeFirstElement(),this.loadNextElement(),this.resizeLayout(),this.updateSliderLayout(),window.setTimeout(t.proxy(function(){this.isLightboxAnimated=!1},this),100)},detectswipe:function(t,e){var i=30,s=30,n=50,a=60,o="";swipe_det=new Object,swipe_det.sX=0,swipe_det.sY=0,swipe_det.eX=0,swipe_det.eY=0,t=t[0],t.addEventListener("touchstart",function(t){var e=t.touches[0];swipe_det.sX=e.screenX,swipe_det.sY=e.screenY},!1),t.addEventListener("touchmove",function(t){var e=t.touches[0];swipe_det.eX=e.screenX,swipe_det.eY=e.screenY,t.preventDefault()},!1),t.addEventListener("touchend",function(t){(swipe_det.eX-i>swipe_det.sX||swipe_det.eX+i<swipe_det.sX)&&swipe_det.eY<swipe_det.sY+a&&swipe_det.sY>swipe_det.eY-a&&swipe_det.eX>0?o=swipe_det.eX>swipe_det.sX?"right":"left":(swipe_det.eY-n>swipe_det.sY||swipe_det.eY+n<swipe_det.sY)&&swipe_det.eX<swipe_det.sX+s&&swipe_det.sX>swipe_det.eX-s&&swipe_det.eY>0&&(o=swipe_det.eY>swipe_det.sY?"down":"up"),""!=o&&"function"==typeof e&&e(o),o="",swipe_det.sX=0,swipe_det.sY=0,swipe_det.eX=0,swipe_det.eY=0},!1)},incrementCurrentIndex:function(){var t=this.getGalleryElements();this.currentIndex++,this.currentIndex>t.length-1&&(this.currentIndex=0)},decrementCurrentIndex:function(){var t=this.getGalleryElements();this.currentIndex--,this.currentIndex<0&&(this.currentIndex=t.length-1)},getCurrentIndex:function(e){var i=this.getGalleryElements(),s=void 0!==e?e:this.trigger,n=i.filter(s),a=-1;return i.each(function(e,i){t(i)[0]===n[0]&&(a=e)}),a},setCurrentIndex:function(){this.currentIndex=this.getCurrentIndex()},focusLightbox:function(){this.lightbox.attr("tabindex",-1).focus()},getYoutubeID:function(t){var e=t.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);return e[2]},getVimeoID:function(t){var e=t.match(/https?:\/\/(?:www\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|)(\d+)(?:$|\/|\?)/);return e[3]},isGallery:function(){var t=this.getGalleryElements();return void 0!==this.trigger.data("gallery")&&t.length>1},getGalleryID:function(){return this.trigger.data("gallery")},getGalleryElements:function(){return t('.lightbox[data-gallery="'+this.getGalleryID()+'"]')},close:function(){this.lightbox&&(this.isLightboxAnimated=!1,this.lightbox.add(this.lightbox.next("."+this.classes.guard)).hide().remove(),this.referer.focus())}}),t.fn.lightbox=function(i){return this.each(t.proxy(function(s,n){var a=t(n);if(!a.data("lightbox")){var o=new e(n,i);for(var r in o.publicMethods)this[r]=o.publicMethods[r];a.data("lightbox",o)}},this)),this}}(jQuery);